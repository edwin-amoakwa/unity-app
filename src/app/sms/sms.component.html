<h1 class="page-title">Send SMS</h1>

<app-card title="SMS Management" >




  <div class="card-body" *ngIf="formView.listView">
    <!-- Header with Create Button -->
    <div class="row mb-3">
      <div class="col-12">
        <p-button
          label="Create SMS"
          icon="pi pi-plus"
          (onClick)="createNewMessage()"
          class="p-button-sm">
        </p-button>
      </div>
    </div>

    <!-- SMS Messages Table -->
    <p-table
      [value]="smsMessages"
      [loading]="isLoading"
      [paginator]="true"
      [rows]="10"
      [responsive]="true"
      styleClass="p-datatable-sm"
      [globalFilterFields]="['senderId', 'applicationId', 'messageText', 'smsNatureName']">

      <ng-template pTemplate="header">
        <tr>
          <th >Date</th>
          <th >Sender ID</th>
          <th >Message</th>
<!--          <th >Phone Numbers</th>-->
          <th >Recipients</th>
          <th >Pages</th>
          <th >Cost</th>
          <th >Status</th>
<!--          <th >Nature</th>-->

          <th style="width: 120px;">Actions</th>
          <th ></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-sms>
        <tr>
          <td>{{ sms.valueDate }}</td>
          <td>{{ sms.senderName }}</td>
          <td>
            <div class="text-truncate" style="max-width: 200px;" [pTooltip]="sms.messageText">
              {{ sms.messageText }}
            </div>
          </td>
<!--          <td>-->
<!--            <div [pTooltip]="sms.phoneNos">-->
<!--              {{ formatPhoneNumbers(sms.phoneNos) }}-->
<!--            </div>-->
<!--          </td>-->
          <td>{{ sms.totalRecipient }}</td>
          <td>{{ sms.pagesCount }}</td>
          <td>{{ sms.actualCost.toFixed(3) }}</td>
          <td>
            <p-tag
              [value]="sms.dispatched ? 'Dispatched' : 'Pending'"
              [severity]="getStatusSeverity(sms.dispatched)">
            </p-tag>
          </td>
<!--          <td>-->
<!--            <p-tag-->
<!--              [value]="sms.smsNatureLabel"-->
<!--              [severity]="getSmsNatureSeverity(sms.smsNatureLabel)">-->
<!--            </p-tag>-->
<!--          </td>-->
<!--          <td>-->
<!--            <div class="flex gap-1">-->
<!--              <p-tag-->
<!--                *ngIf="sms.flashSms"-->
<!--                value="Flash"-->
<!--                severity="danger"-->
<!--                class="text-xs">-->
<!--              </p-tag>-->
<!--              <p-tag-->
<!--                *ngIf="sms.scheduleSms"-->
<!--                value="Scheduled"-->
<!--                severity="info"-->
<!--                class="text-xs">-->
<!--              </p-tag>-->
<!--              <p-tag-->
<!--                *ngIf="sms.templateSms"-->
<!--                value="Template"-->
<!--                severity="warning"-->
<!--                class="text-xs">-->
<!--              </p-tag>-->
<!--            </div>-->
<!--          </td>-->
<!--          <td>{{ formatScheduledTime(sms.scheduledTime) }}</td>-->
          <td>
            <div class="flex gap-1">
              <p-button
                icon="pi pi-pencil"
                size="small"
                severity="info"
                [text]="true"
                pTooltip="Edit"
                tooltipPosition="left"
                (onClick)="openEditDialog(sms)">
              </p-button>

              <p-button
                icon="pi pi-clone"
                size="small"
                severity="secondary"
                [text]="true"
                pTooltip="Duplicate"
                tooltipPosition="left"
                (onClick)="duplicateSms(sms)">
              </p-button>

              <p-button
                icon="pi pi-trash"
                size="small"
                severity="danger"
                [text]="true"
                pTooltip="Delete"
                tooltipPosition="left"
                (onClick)="deleteSms(sms)">
              </p-button>

            </div>
          </td>
          <td>
            <p-button
              icon="pi pi-send"
              size="small"
              severity="success"
              [text]="true"
              pTooltip="Initiate/Send"
                tooltipPosition="left"
              (onClick)="initiateSms(sms)">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="12" class="text-center p-4">
            <div class="flex flex-column align-items-center gap-2">
              <i class="pi pi-inbox text-4xl text-muted"></i>
              <p class="text-muted mb-0">No SMS messages found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>


  <div class="card-body" *ngIf="formView.createView">

    <app-sms-form
      [smsData]="selectedSms"
      (smsSubmitted)="onSmsSubmitted($event)"
      (cancelled)="this.formView.resetToListView()">
    </app-sms-form>

<!--    <p-button-->
<!--      label="Close" severity="contrast"-->
<!--      icon="pi pi-close"-->
<!--      (onClick)="formView.resetToListView()"-->
<!--      class="p-button-sm">-->
<!--    </p-button>-->


  </div>




</app-card>

<!-- SMS Form Dialog -->
<!--<p-dialog-->
<!--  [header]="selectedSms ? 'Edit SMS Message' : 'Create SMS Message'"-->
<!--  [(visible)]="showDialog"-->
<!--  [style]="{ width: '600px' }"-->
<!--  [modal]="true"-->
<!--  [draggable]="false"-->
<!--  [resizable]="false">-->

<!--  <app-sms-form-->
<!--    [smsData]="selectedSms"-->
<!--    (smsSubmitted)="onSmsSubmitted($event)"-->
<!--    (cancelled)="closeDialog()">-->
<!--  </app-sms-form>-->
<!--</p-dialog>-->

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>
