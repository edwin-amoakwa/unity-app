<app-card cardTitle="SMS Records">
  <div class="card-body">
    <!-- Filter Section -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="finalStatus" class="form-label">Final Status</label>
        <p-dropdown
          id="finalStatus"
          [options]="finalStatusOptions"
          [(ngModel)]="selectedFinalStatus"
          optionLabel="itemName"
          optionValue="id"
          placeholder="Select Final Status"
          [showClear]="true"
          (onChange)="onFilterChange()"
          styleClass="w-100">
        </p-dropdown>
      </div>
      <div class="col-md-3">
        <label for="senderId" class="form-label">Sender ID</label>
        <p-dropdown
          id="senderId"
          [options]="senderIdOptions"
          [(ngModel)]="selectedSenderId"
          optionLabel="senderId"
          optionValue="id"
          placeholder="Select Sender ID"
          [showClear]="true"
          (onChange)="onFilterChange()"
          styleClass="w-100">
        </p-dropdown>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <p-button
          label="Clear Filters"
          icon="pi pi-filter-slash"
          severity="secondary"
          size="small"
          (onClick)="clearFilters()">
        </p-button>
      </div>
    </div>

    <!-- SMS Records Table -->
    <p-table
      [value]="smsRecords"
      [loading]="isLoading"
      [paginator]="true"
      [rows]="20"
      [responsive]="true"
      styleClass="p-datatable-sm"
      [scrollable]="true"
      scrollHeight="600px">

      <ng-template pTemplate="header">
        <tr>
          <th style="min-width: 120px;">Mobile No</th>
          <th style="min-width: 100px;">Sender ID</th>
          <th style="min-width: 120px;">Application</th>
          <th style="min-width: 100px;">Recipient</th>
          <th style="min-width: 200px;">SMS Text</th>
          <th style="min-width: 120px;">SMS Provider</th>
          <th style="min-width: 100px;">SMS Status</th>
          <th style="min-width: 100px;">Final Status</th>
          <th style="min-width: 120px;">Internal Status</th>
          <th style="min-width: 100px;">External ID</th>
          <th style="min-width: 120px;">Provider Status</th>
          <th style="min-width: 120px;">Processing No</th>
          <th style="min-width: 100px;"> Cost</th>
          <th style="min-width: 80px;">Pages</th>
          <th style="min-width: 140px;">Delivered Time</th>
          <th style="min-width: 120px;">Institution</th>
          <th style="min-width: 120px;">Callback URL</th>
          <th style="min-width: 100px;">Feedback</th>
          <th style="min-width: 100px;">URL Reached</th>
          <th style="min-width: 120px;">Feedback Count</th>
          <th style="min-width: 100px;">Batch ID</th>
          <th style="min-width: 140px;">Created Date</th>
          <th style="min-width: 140px;">Modified Date</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-record>
        <tr>
          <td>{{ record.mobileNo }}</td>
          <td>{{ record.senderId }}</td>
          <td>{{ record.application }}</td>
          <td>{{ record.receipient }}</td>
          <td>
            <div class="text-truncate" style="max-width: 200px;" [pTooltip]="record.smsText">
              {{ truncateText(record.smsText, 50) }}
            </div>
          </td>
          <td>{{ record.smsProviderLabel }}</td>
          <td>
            <p-tag
              [value]="record.smsStatusLabel"
              [severity]="getSmsStatusSeverity(record.smsStatusLabel)">
            </p-tag>
          </td>
          <td>
            <p-tag
              [value]="record.finalStatusLabel"
              [severity]="getFinalStatusSeverity(record.finalStatusLabel)">
            </p-tag>
          </td>
          <td>{{ record.internalStatus }}</td>
          <td>{{ record.externalId }}</td>
          <td>{{ record.providerStatus }}</td>
          <td>{{ record.processingNo }}</td>
          <td>{{ formatCurrency(record.actualCost) }}</td>
          <td>{{ record.pageCount }}</td>
          <td>{{ formatDateTime(record.deliveredTime) }}</td>
          <td>{{ record.institutionName }}</td>
          <td>
            <div class="text-truncate" style="max-width: 120px;" [pTooltip]="record.callBackUrl">
              {{ truncateText(record.callBackUrl, 20) }}
            </div>
          </td>
          <td>
            <p-tag
              [value]="record.feedBackReceived ? 'Yes' : 'No'"
              [severity]="record.feedBackReceived ? 'success' : 'warning'">
            </p-tag>
          </td>
          <td>
            <p-tag
              [value]="record.urlReached ? 'Yes' : 'No'"
              [severity]="record.urlReached ? 'success' : 'danger'">
            </p-tag>
          </td>
          <td>{{ record.feedbackRequestCount }}</td>
          <td>{{ record.batchId }}</td>
          <td>{{ formatDateTime(record.createdDate) }}</td>
          <td>{{ formatDateTime(record.modifiedDate) }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="25" class="text-center p-4">
            <div class="flex flex-column align-items-center gap-2">
              <i class="pi pi-inbox text-4xl text-muted"></i>
              <p class="text-muted mb-0">No SMS records found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</app-card>
