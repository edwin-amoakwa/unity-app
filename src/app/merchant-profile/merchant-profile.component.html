

<div class="auth-container1">
  <div class="auth-background">
    <div class="background-overlay"></div>
  </div>

  <div class="auth-content">
    <div class="glass-container">
      <div class="login-header">
        <h1 class="login-title">{{ merchant?.accountStatus === 'PENDING' ? 'Edit Profile' : 'Merchant Profile' }}</h1>
        <p class="login-subtitle">Update your registration details, get approved </p>
      </div>


      <!-- Read-only details when not pending -->
      <div *ngIf="merchant && merchant.accountStatus !== 'PENDING'" class="details-view">
        <div class="row mb-3">
          <div class="col-md-3"><strong>Company Name:</strong></div>
          <div class="col-md-9">{{ merchant.merchantName }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Contact Person:</strong></div>
          <div class="col-md-9">{{ merchant.contactName || 'Not provided' }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Mobile Number:</strong></div>
          <div class="col-md-9">{{ merchant.contactMobileNo || 'Not provided' }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Email Address:</strong></div>
          <div class="col-md-9">{{ merchant.contactEmailAddress }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Country:</strong></div>
          <div class="col-md-9">{{ merchant.countryName || 'Not provided' }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Industry:</strong></div>
          <div class="col-md-9">
            <ng-container *ngIf="merchant.industryId as indId">
              <ng-container *ngFor="let ind of industries">
                <span *ngIf="ind.id === indId">{{ ind.industryName }}</span>
              </ng-container>
            </ng-container>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Billing Address:</strong></div>
          <div class="col-md-9">{{ merchant.billingAddress || 'Not provided' }}</div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3"><strong>Account Status:</strong></div>
          <div class="col-md-9"><span class="badge bg-primary">{{ merchant.accountStatus }}</span></div>
        </div>

        <div class="row mb-3" *ngIf="merchant?.businessDocUrl">
          <div class="col-md-3"><strong>Business Document:</strong></div>
          <div class="col-md-9">
            <a class="doc-link" [href]="merchant.businessDocUrl" target="_blank" rel="noopener noreferrer">
              View uploaded document
            </a>
          </div>
        </div>
      </div>

      <!-- Editable form only when pending -->
      <form *ngIf="merchant?.accountStatus === 'PENDING'" [formGroup]="registerForm" (ngSubmit)="updateProfile()" class="login-form">
        <div class="form-grid">
          <!-- Company Name -->
          <div class="form-group">
            <label for="merchantName" class="form-label">Company Name</label>
            <div class="input-container">
              <i class="pi pi-building"></i>
              <input
                pInputText
                type="text"
                id="merchantName"
                formControlName="merchantName"
                placeholder="Enter company name"
              />
            </div>
            <div *ngIf="isFieldInvalid('merchantName')" class="field-error">
              <small>{{ getFieldError('merchantName') }}</small>
            </div>
          </div>

          <!-- Contact Person -->
          <div class="form-group">
            <label for="contactPerson" class="form-label">Contact Person</label>
            <div class="input-container">
              <i class="pi pi-user"></i>
              <input
                pInputText
                type="text"
                id="contactName"
                formControlName="contactName"
                placeholder="Enter contact person name"
              />
            </div>
            <div *ngIf="isFieldInvalid('contactName')" class="field-error">
              <small>{{ getFieldError('contactName') }}</small>
            </div>
          </div>


          <div class="form-group">
            <label for="industryId" class="form-label">Industry</label>
            <div class="input-container">
              <i class="pi pi-briefcase"></i>
              <p-select
                inputId="industryId"
                [options]="industries"
                formControlName="industryId"
                optionLabel="industryName"
                optionValue="id"
                [filter]="true"
                filterBy="industryName"
                placeholder="Select an Industry"
                >
                <ng-template #selectedItem let-selectedOption>
                  <div class="flex items-center gap-2">
                    <span>{{ selectedOption?.industryName }}</span>
                  </div>
                </ng-template>
                <ng-template let-industry #item>
                  <div class="flex items-center gap-2">
                    <span>{{industry?.industryName }}</span>
                  </div>
                </ng-template>
              </p-select>
            </div>
            <div *ngIf="isFieldInvalid('industryId')" class="field-error">
              <small>{{ getFieldError('industryId') }}</small>
            </div>
          </div>


          <div class="form-group">
            <label for="mobileNo" class="form-label">Mobile Number</label>
            <div class="input-container">
              <i class="pi pi-phone"></i>

              <p-select [options]="countries" formControlName="countryId" readonly
                        optionLabel="countryName" [filter]="true"
                        filterBy="countryName"  optionValue="id" placeholder="Select a Country">
                <ng-template #selectedItem let-selectedOption>
                  <div class="flex items-center gap-2">
                    <i class="fi" [ngClass]="'fi-' + selectedOption.countryCode"></i>
                    <span>{{ selectedOption.countryName }}</span>
                  </div>
                </ng-template>
                <ng-template let-country #item>
                  <div class="flex items-center gap-2">
                    <i class="fi" [ngClass]="'fi-' + country.countryCode"></i>
                    <span style="margin-left: 5px;">{{ country.countryName }}</span>
                  </div>
                </ng-template>
              </p-select>

<!--              <div class="flex items-center gap-2">-->
<!--                <i class="fi" [ngClass]="'fi-' + merchant.countryCode"></i>-->
<!--                <span style="margin-left: 5px;">{{ merchant.countryName }}</span>-->
<!--              </div>-->

              <input
                pInputText
                type="tel"
                id="contactMobileNo"
                formControlName="contactMobileNo"
                placeholder="Enter mobile number"
                [attr.minlength]="phoneNumberLength"
                [attr.maxlength]="phoneNumberLength"
                [attr.pattern]="mobilePattern"
                aria-label="mobile number"
              />
            </div>
            <div *ngIf="isFieldInvalid('contactMobileNo')" class="field-error">
              <small>{{ getFieldError('contactMobileNo') }}</small>
            </div>
          </div>

          <!-- Email Address -->
          <div class="form-group">
            <label for="contactEmailAddress" class="form-label">Email Address</label>
            <div class="input-container">
              <i class="pi pi-envelope"></i>
              <input
                pInputText
                type="email"
                id="contactEmailAddress"
                formControlName="contactEmailAddress"
                placeholder="Enter email address"
              />
            </div>
            <div *ngIf="isFieldInvalid('contactEmailAddress')" class="field-error">
              <small>{{ getFieldError('contactEmailAddress') }}</small>
            </div>
          </div>

          <!-- Billing Address -->
          <div class="form-group full-width">
            <label for="billingAddress" class="form-label">Billing Address</label>
            <div class="input-container">
              <i class="pi pi-map-marker"></i>
              <textarea pTextarea
                id="billingAddress"
                formControlName="billingAddress"
                rows="3"
                placeholder="Enter billing address"
                style="flex: 1 1 auto; width: 100%"
              ></textarea>
            </div>
            <div *ngIf="isFieldInvalid('billingAddress')" class="field-error">
              <small>{{ getFieldError('billingAddress') }}</small>
            </div>
          </div>


          <div class="row">
            <div class="col-auto">
              <input #fileInput (change)="onFileChange($event)" class="form-control" type="file">
            </div>
<!--            <div class="col-auto">-->
<!--              <button type="button" pButton (click)="upload()">Upload</button>-->
<!--            </div>-->
<!--            <div class="col-auto">-->
<!--              <button type="button" pButton class="p-button-success" (click)="clearUploadForm()">-->
<!--                <i class="pi pi-times" aria-hidden="true"></i>-->
<!--                <span>Clear</span>-->
<!--              </button>-->
<!--            </div>-->
          </div>


          <!-- Business Document Link -->
          <div class="form-group full-width" *ngIf="merchant?.businessDocUrl">
            <label class="form-label">Business Document</label>
            <div class="input-container">
              <i class="pi pi-file doc-link-icon"></i>
              <a class="doc-link" [href]="merchant.businessDocUrl" target="_blank" rel="noopener noreferrer">
                View uploaded document
              </a>
            </div>
          </div>



          <!-- Submit button -->
          <div class="full-width">
            <button
              type="submit"
              class="login-button"
              [class.loading]="isLoading"
              [disabled]="isLoading"
            >
              <span *ngIf="!isLoading" class="button-text">
                <i class="pi pi-user-plus"></i>
                Update Profile
              </span>
              <span *ngIf="isLoading" class="loading-spinner">
                <i class="pi pi-spinner pi-spin"></i>
                Updating Profile
              </span>
            </button>
          </div>

        </div>
      </form>

    </div>
  </div>



  <br />
  <app-sms-channel-price></app-sms-channel-price>



</div>
